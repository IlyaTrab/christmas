<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>AR — Snowman</title>

  <!-- model-viewer -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    html,body{margin:0;height:100%;background:#000}
    model-viewer{position:fixed;inset:0;width:100%;height:100%}

    /* стиль кнопки AR */
    .ar-btn{
      position:fixed;left:50%;bottom:20px;transform:translateX(-50%);
      padding:.9rem 1.2rem;border-radius:.8rem;border:1px solid rgba(255,255,255,.3);
      background:rgba(255,255,255,.15);backdrop-filter:blur(10px);
      color:#fff;font:600 16px system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      box-shadow:0 6px 18px rgba(0,0,0,.35);
    }
  </style>
</head>
<body>

  <model-viewer id="mv"
    src="assets/snowman.glb"
    ar ar-modes="scene-viewer quick-look webxr"
    camera-controls shadow-intensity="1"
    exposure="1.0" environment-image="neutral">
    <button slot="ar-button" class="ar-btn">Открыть в AR</button>
  </model-viewer>

  <script>
    // Если пришли как ar.html?autoplay=1 — пробуем сразу открыть AR
    const mv = document.getElementById('mv');
    const qs = new URL(location.href).searchParams;
    if (qs.get('autoplay') === '1') {
      const tryActivate = () => {
        // На Android Scene Viewer запустится, на iOS Quick Look сгенерирует USDZ сам (без ios-src)
        if (mv.activateAR) mv.activateAR().catch(()=>{ /* может потребоваться ручной тап */ });
      };
      if (mv.loaded) tryActivate();
      else mv.addEventListener('load', tryActivate, { once: true });
    }
  </script>
</body>
</html>
