<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>AR — Snowman</title>

  <!-- model-viewer -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    html,body{margin:0;height:100%;background:#000;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    model-viewer{position:fixed;inset:0;width:100%;height:100%}
    .ar-btn{
      position:fixed;left:50%;bottom:20px;transform:translateX(-50%);
      padding:.9rem 1.2rem;border-radius:.8rem;border:1px solid rgba(255,255,255,.3);
      background:rgba(255,255,255,.15);backdrop-filter:blur(10px);
      color:#fff;font:600 16px;box-shadow:0 6px 18px rgba(0,0,0,.35);
    }
    #hud{
      position:fixed;top:10px;left:50%;transform:translateX(-50%);
      font-size:12px;opacity:.85;text-shadow:0 1px 2px rgba(0,0,0,.6)
    }
  </style>
</head>
<body>

  <div id="hud">Подсказка: в AR перемещай модель одним пальцем, масштабируй пинч-жестом.</div>

  <model-viewer id="mv"
    src="assets/snowman.glb"
    ar ar-modes="scene-viewer quick-look webxr"
    ar-placement="floor"           <!-- ставим на пол -->
    ar-scale="auto"                <!-- разрешаем масштаб в AR жестами -->
    camera-controls
    auto-rotate auto-rotate-delay="0"
    shadow-intensity="1"
    exposure="1.0"
    environment-image="neutral">
    <button slot="ar-button" class="ar-btn">Открыть в AR</button>
  </model-viewer>

  <script>
    const mv = document.getElementById('mv');

    // Начальный масштаб/поворот модели (чтобы не была гигантской)
    // Подстрой значение 'S' если всё ещё великовато/мелковато.
    const S = 0.25;                           // 25% от исходного размера
    const YAW_DEG = 0;                        // можно поставить 180, если «смотрит спиной»

    mv.addEventListener('load', () => {
      try {
        // доступ к сцене модели
        const m = mv.model;
        if (m) {
          m.scale.set(S, S, S);
          m.rotation.set(0, YAW_DEG * Math.PI / 180, 0);
          m.position.set(0, 0, 0);
        }
      } catch (e) {
        console.warn('Не удалось применить масштаб/поворот через API model-viewer:', e);
      }
    });

    // Автозапуск AR, если пришли с ?autoplay=1
    const qs = new URL(location.href).searchParams;
    if (qs.get('autoplay') === '1') {
      const tryActivate = () => {
        if (mv.activateAR) mv.activateAR().catch(()=>{ /* нужен ручной тап — это ок */ });
      };
      if (mv.loaded) tryActivate();
      else mv.addEventListener('load', tryActivate, { once: true });
    }
  </script>
</body>
</html>
