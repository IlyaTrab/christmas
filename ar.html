<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>AR — Snowman</title>

  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    html,body{margin:0;height:100%;background:#000;color:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    model-viewer{position:fixed;inset:0;width:100%;height:100%}
    .ar-btn{
      position:fixed;left:50%;bottom:20px;transform:translateX(-50%);
      padding:.9rem 1.2rem;border-radius:.8rem;border:1px solid rgba(255,255,255,.3);
      background:rgba(255,255,255,.15);backdrop-filter:blur(10px);
      color:#fff;font:600 16px;box-shadow:0 6px 18px rgba(0,0,0,.35);
    }
    #hud{
      position:fixed;top:10px;left:50%;transform:translateX(-50%);
      font-size:12px;opacity:.85;text-shadow:0 1px 2px rgba(0,0,0,.6)
    }
  </style>
</head>
<body>

  <div id="hud">В AR: перетаскивай одним пальцем, масштаб — пинч. Если у модели есть анимация — она запустится.</div>

  <model-viewer id="mv"
    src="assets/snowman.glb"
    ar ar-modes="scene-viewer quick-look webxr"
    ar-placement="floor"
    ar-scale="auto"
    camera-controls
    auto-rotate auto-rotate-delay="0"
    shadow-intensity="1"
    exposure="1.0"
    environment-image="neutral">
    <button slot="ar-button" class="ar-btn">Открыть в AR</button>
  </model-viewer>

  <script>
    const mv = document.getElementById('mv');

    // Начальный масштаб/ориентация в 3D-просмотре до входа в AR
    const START_SCALE = 0.15;   // УМЕНЬШИ при необходимости (например, 0.08)
    const YAW_DEG = 0;          // Поворот по Y, если «смотрит не туда»

    mv.addEventListener('load', () => {
      try {
        // уменьшаем модель
        if (mv.model) {
          mv.model.scale.set(START_SCALE, START_SCALE, START_SCALE);
          mv.model.rotation.set(0, YAW_DEG * Math.PI/180, 0);
        }
      } catch (e) {
        console.warn('Scale/rotation set failed:', e);
      }

      // Если в модели есть анимации — запустим первую
      try {
        const clips = mv.availableAnimations || [];
        if (clips.length) {
          mv.animationName = clips[0]; // можно выбрать по имени
          mv.autoplay = true;          // автозапуск анимации
        }
      } catch (e) {
        console.warn('Animation setup failed:', e);
      }
    });

    // Автовызов AR при ?autoplay=1 (может потребоваться ручной тап, это ок)
    const qs = new URL(location.href).searchParams;
    if (qs.get('autoplay') === '1') {
      const go = () => mv.activateAR && mv.activateAR().catch(()=>{});
      if (mv.loaded) go(); else mv.addEventListener('load', go, { once: true });
    }
  </script>
</body>
</html>
